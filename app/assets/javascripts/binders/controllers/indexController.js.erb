'use strict';

angular.module('binderApp')
  .controller('IndexController', [
      'shelves',
      'ShelfSvc',
      'BinderSvc',
      function(shelves, ShelfSvc, BinderSvc) {
        var indexCtrl = this;
        indexCtrl.shelves = shelves.map(function(shelf){return ShelfSvc.build(shelf)});
        indexCtrl.binders = [];
        indexCtrl.shelves.forEach(function(shelf){
          if(shelf.binders && shelf.binders.length && shelf.binders.length > 0){
            indexCtrl.binders = indexCtrl.binders.concat(shelf.binders);
          }
        })

        indexCtrl.addShelf = function(){
          var newShelf = ShelfSvc.build({name: 'New Shelf'});
          newShelf.$create();
          indexCtrl.shelves.push(newShelf);
        }

        indexCtrl.addBinder = function(shelf){
          var newBinder = BinderSvc.build({name: 'New Binder', shelf_id: shelf.id});
          newBinder.$save();
          shelf.binders.push(newBinder);
        }

        indexCtrl.saveShelf = function(shelf){
          shelf.$save();
        }

        indexCtrl.saveBinder = function(binder){
          binder.$save();
        }
      }
  ]);
